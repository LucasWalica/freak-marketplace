<nav class="sticky top-0 z-[100] w-full bg-freak-dark/90 backdrop-blur-md">
  <div class="absolute inset-0 pointer-events-none bg-scanlines opacity-[0.03]"></div>
  <div class="absolute bottom-0 left-0 w-full h-[1px] bg-gradient-to-r from-transparent via-freak-primary/50 to-transparent"></div>
  <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-48 h-[2px] bg-freak-secondary shadow-neon"></div>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between h-20 items-center">
      
      <div class="flex items-center space-x-4 lg:space-x-10">
        <a routerLink="/home" class="group relative shrink-0">
          <div class="flex flex-col">
            <span class="text-xl sm:text-2xl font-display font-black tracking-[-2px] text-white italic group-hover:text-freak-secondary transition-colors">
              FREAK<span class="text-freak-primary group-hover:text-white">MARKET</span>
            </span>
            <div class="flex gap-1 mt-[-4px]">
              <div class="h-[2px] w-8 bg-freak-primary"></div>
              <div class="h-[2px] w-2 bg-freak-secondary"></div>
            </div>
          </div>
        </a>

        <div class="hidden md:flex items-center space-x-1">
          <a *ngFor="let link of [{url:'/home', label:'[ INICIO ]'}, {url:'/products', label:'[ PRODUCTOS ]'}, {url:'/categories', label:'[ COLECCIONES ]'}]"
             [routerLink]="link.url"
             routerLinkActive="!text-freak-secondary"
             class="px-3 lg:px-4 py-2 font-geek text-[10px] tracking-[2px] text-white/60 hover:text-white transition-all">
            {{link.label}}
          </a>
        </div>
      </div>

      <div class="flex items-center space-x-3 sm:space-x-6">
        
        <div class="hidden sm:block relative">
          <input
            type="text"
            placeholder="BUSCAR..."
            class="w-32 lg:w-48 focus:w-64 px-4 py-1.5 bg-freak-dark/50 border-b border-white/10 font-geek text-[9px] text-white transition-all duration-500 focus:border-freak-secondary outline-none"
            [(ngModel)]="searchQuery"
          >
        </div>

        <div class="flex items-center gap-3 sm:gap-6" *ngIf="isAuthenticated$ | async; else guestMenu">
          
          <button (click)="navigateToChat()" class="relative group p-2">
            <svg class="w-5 h-5 text-white/70 group-hover:text-freak-secondary transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-width="1.5" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0a2 2 0 01-2 2H6a2 2 0 01-2-2m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/>
            </svg>
            <span *ngIf="(unreadCount$ | async) as count" class="absolute top-0 right-0 bg-freak-accent text-freak-dark font-black text-[8px] px-1 rounded-sm">
              {{count}}
            </span>
          </button>

          <div class="relative hidden md:block">
            <button (click)="toggleUserMenu()" class="flex items-center gap-3 pl-1 pr-3 py-1 rounded-sm border-l-2 border-freak-secondary bg-white/5">
              <img [src]="(currentUser$ | async)?.avatar_url || '/assets/default-avatar.png'" class="h-7 w-7 rounded-sm object-cover">
              <span class="font-geek text-[9px] text-white tracking-widest uppercase">
                {{(currentUser$ | async)?.username}}
              </span>
            </button>
            
            <div *ngIf="isUserMenuOpen" class="absolute right-0 mt-4 w-52 bg-freak-dark border-2 border-freak-primary shadow-2xl animate-slide-up">
               </div>
          </div>
        </div>

        <ng-template #guestMenu>
          <div class="hidden md:flex items-center gap-4">
            <a routerLink="/auth/login" class="font-geek text-[10px] text-white/50 hover:text-freak-secondary italic">_LOGIN</a>
            <button routerLink="/auth/register" class="bg-freak-secondary px-4 py-1.5 font-geek text-[10px] font-black text-freak-dark skew-x-[-15deg]">ACCEDER</button>
          </div>
        </ng-template>

        <button (click)="isMobileMenuOpen = !isMobileMenuOpen" class="md:hidden p-2 text-freak-primary">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path *ngIf="!isMobileMenuOpen" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"/>
            <path *ngIf="isMobileMenuOpen" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>

      </div>
    </div>
  </div>

  <div *ngIf="isMobileMenuOpen" class="md:hidden bg-freak-dark border-t border-white/10 animate-fade-in">
    <div class="px-4 py-6 space-y-4">
      <a *ngFor="let link of [{url:'/home', label:'INICIO'}, {url:'/products', label:'PRODUCTOS'}, {url:'/categories', label:'COLECCIONES'}]"
         [routerLink]="link.url" (click)="isMobileMenuOpen = false"
         class="block font-geek text-xs text-white/70 hover:text-freak-primary tracking-[4px]">
        > {{link.label}}
      </a>
      
      <div class="h-px bg-white/5 my-4"></div>
      
      <div *ngIf="isAuthenticated$ | async" class="flex items-center gap-4 p-3 bg-white/5 rounded-sm">
        <img [src]="(currentUser$ | async)?.avatar_url || '/assets/default-avatar.png'" class="h-10 w-10 rounded-sm">
        <div class="flex-1">
          <div class="font-display text-white text-sm italic">{{(currentUser$ | async)?.username}}</div>
          <button (click)="logout()" class="font-geek text-[8px] text-freak-danger uppercase">Desconectar_Terminal</button>
        </div>
      </div>

      <div *ngIf="!(isAuthenticated$ | async)" class="grid grid-cols-2 gap-4">
        <a routerLink="/auth/login" class="text-center py-3 border border-white/10 font-geek text-[10px] text-white">LOGIN</a>
        <a routerLink="/auth/register" class="text-center py-3 bg-freak-primary font-geek text-[10px] text-black font-bold">REGISTRO</a>
      </div>
    </div>
  </div>
</nav>